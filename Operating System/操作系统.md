---
title: 操作系统整理
date: 2020-09-22 20:30:50
tags: 
- Operating System
categories:
- Operating System
toc: true
reward: true
---

## 操作系统概述

### 定义

- 能有效地组织和管理系统中的各种软硬件资源，合理地组织计算机系统地工作流程，控制程序的执行，并且向用户提供一个良好的工作环境和友好的接口。

### 作用

- 通过资源管理提高计算机系统的效率
- 改善人机界面向用户提供良好的工作环境

### 特征

- 并发性
- 共享性
- 虚拟性
- 不确定性

### 功能

- 进程管理

	- 进程控制
	- 进程同步
	- 进程通信
	- 进程调度

- 文件管理

	- 文件存储空间管理
	- 目录管理
	- 文件的读/写管理
	- 存取控制

- 存储管理

	- 存储分配与回收
	- 存储保护
	- 地址映射（变换）
	- 主存扩充

- 设备管理

	- 输入/输出设备的分配、启动、完成和回收

- 作业管理

	- 任务
	- 界面管理
	- 人机交互
	- 图形界面
	- 语音控制
	- 虚拟现实

### 分类

- 批处理操作系统

	- 单道批处理

		- 一次只有一个作业装入内存执行

	- 多道批处理

		- 允许多个作业装入内存执行
		- 特点

			- 多道
			- 宏观上并行运行
			- 微观上串行运行

- 分时操作系统

	- 分为时间片，轮流为各个终端的用户服务
	- 特点

		- 多路性
		- 独立性
		- 交互性
		- 及时性

- 实时操作系统

	- 实时控制系统
	- 实时信息处理系统

- 网络操作系统

	- 特征

		- 硬件独立性
		- 多用户支持

	- 类别

		- 集中模式

			- 分时操作系统+网络功能
			- 信息的处理和控制是集中的

		- 客户端/服务器模式
		- 对等模式(Peer-to-Peer)

			- 站点既可以作为客户端也可以作为服务器
			- 具有分布处理和分布控制的特征

- 分布式操作系统

	- 网络操作系统的更高级形式
	- 特征

		- 透明性
		- 可靠性
		- 高性能

- 微型计算机操作系统
- 嵌入式操作系统

	- 特征

		- 微型化
		- 可定制
		- 实时性
		- 可靠性
		- 易移植性

## 进程管理（处理机管理）

### 目的

- 研究进程之间的并发特性
- 以及进程之间相互合作和资源竞争产生的问题

### 程序

- 顺序执行的特征

	- 顺序性
	- 封闭性
	- 可再现性

- 并发执行的特征

	- 失去了封闭性
	- 程序和机器的执行程序的活动不再一一对应
	- 并发程序间的相互制约性

### 进程

- 资源分配和独立运行的基本单位

	- 传统进程的两个基本属性

		- 可拥有资源的独立单位
		- 可独立调度和分配的基本单位

			- （线程）

- 组成

	- 程序

		- 可以被多个进程共享执行，是程序执行时不可修改的部分

	- 数据

		- 只能为一个进程所用，是进程可以修改的部分

	- 进程控制块(PCB)

- 状态

	- 三态模型

		- 运行
		- 就绪
		- 阻塞

	- 五态模型

		- 新建

			- 1. 为一个新进程创建必要的管理信息
			- 2. 让该进程进入就绪状态

		- 就绪
		- 运行
		- 阻塞
		- 终止

			- 1. 等待操作系统进行善后处理
			- 2. 释放内存

	- 具有挂起状态的进程状态

		- 活跃就绪

			- 进程在主存、可被调度

		- 静止就绪

			- 进程在辅存

		- 活跃阻塞

			- 进程在主存

		- 静止阻塞

			- 进程在辅存

### 线程

- 引入线程的原因

	- 进程在创建、撤销和切换中，系统必须为之付出较大的时空开销，故在系统中设置的进程数目不宜过多，进程切换的频率不宜太高，这就限制了并发程度的提高。用户可以通过创建线程来完成任务，以减少程序并发执行时付出的时空开销。
	- 引入线程后，将传统进程的两个基本属性分开，线程作为调度和分配的基本单位，进程作为独立分配资源的单位。
	- 用户可以通过创建线程来完成任务，以减少程序并发执行时付出的时空开销。
	- 这样，对于拥有资源的基本单位——进程，不用频繁地被切换，提高了系统中各程序的并发程度

- 线程是进程中的一个实体，是被系统独立分配和调度的基本单位。线程基本上不拥有资源，它可与同属一个进程的其他线程共享进程所拥有的所有资源。

	- 线程可创建另一个线程，同一个进程中的多个线程可并发执行

- 状态

	- 就绪
	- 运行
	- 阻塞

- 分类

	- 用户级线程

		- 创建、撤销和切换都不依赖于内核

	- 内核支持线程

		- 依赖于内核

- 与进程的区别

	- 线程：利用 CPU 的最小单位
进程：拥有资源、独立分配资源的基本单位
	- 线程：可共享
进程：相互独立
	- 线程：可以不依赖于系统内核（用户级线程）
进程：都要依赖于内核中的进程调度

### 进程控制

- 由操作系统内核的原语实现

	- 内核

		- 计算机系统硬件的首次延伸
		- 基于硬件的第一层软件扩充
		- 为系统对进程进行控制和管理提供了良好的环境

	- 原语

		- 由若干条机器指令组成
		- 特点：在执行时不能被分割（要么都做，要么都不做）
		- 类别

			- 进程控制原语

				- 进程创建原语
				- 进程撤销原语
				- 进程挂起原语
				- 进程激活原语
				- 进程阻塞原语
				- 进程唤醒原语

			- 进程通信原语
			- 资源管理原语

### 进程间的通信

- 同步

	- 同步是【合作】进程的【直接】制约问题
	- 相互合作、协同工作的进程

- 互斥

	- 互斥是【申请临界资源】进程间的【间接】制约问题
	- 临界资源（CR)：一次只能供一个进程使用

- 临界区

	- 进程中对临界资源实施操作的那段程序
	- 原则

		- 有空即进（但只能在临界区运行有限时间）
		- 无空则等
		- 有限等待（保证进程在有限时间进入临界区）
		- 让权等待（进程不能进入临界区时释放处理机）

- 信号量

	- 整型信号量

		- 公用信号量

			- 实现进程间的互斥
			- 初值为 1 或资源的数目

		- 私用信号量

			- 实现进程间的同步
			- 初值为 0 或某个正整数

		- 信号量 S

			- S >= 0 表示资源的可用数
			- S < 0 绝对值表示阻塞队列中等待该资源的进程数

		- P 操作

			- 申请一个资源
			- S = S - 1

				- S >= 0 执行 P 操作的进程继续执行
				- S < 0 置该进程为阻塞状态，加入阻塞队列

		- V 操作

			- 释放一个资源
			- S = S + 1

				- S > 0 执行 V 操作的进程继续执行
				- S <= 0 从阻塞状态唤醒一个进程，加入就绪队列，然后执行 V 操作的进程继续执行
（S++后仍然 <= 0，说明之前的 S < 0，说明阻塞队列中有进程需要唤醒）

	- 记录型信号量
	- 信号量集机制
	- 高级通信原语

		- PV操作的缺点

			- 容易引起死锁
			- 效率低（生产者每次只能向缓冲区放一个消息，消费者只能从缓冲区取一个消息）

		- 分类

			- 共享存储模式
			- 消息传递模式
			- 管道通信

				- 管道

					- 用于连接一个读进程和一个写进程，以实现它们之间通信的共享文件（pipe文件）
					- 向管道（共享文件）提供输入的发送进程（即写进程），以字符流的形式将大量的数据送入管道；而接收进程可以从管道接收大量的数据。

### 管程

- 另一种同步机制，基本思路：采用资源集中管理的方法，将系统中的资源用某种数据结构抽象地表示出来。由于临界区是访问共享资源的代码段，建立一个管程管理进程提出的访问请求。
- 管程由一些共享数据、一组能为并发进程所执行的作用在共享数据上的操作的集合、初始代码以及存取权组成
- 管程提供了一种可以允许多进程安全、有效地共享抽象数据类型的机制
- 管程实现同步机制由“条件结构”所提供，为实现进程互斥同步，必须定义一些条件变量。

	- var notempty、notfull: condition
	- 这些条件变量只能被 wait 和 signal 操作所访问

		- notfull.wait: 调用该操作的进程将被挂起，使另一个进程执行
		- notfull.signal: 启动一个被挂起的进程，若无被挂起的进程，则空操作（与 V 操作的不同点）

- 管程自动实现互斥访问

	- 由于管程保证内部操作的互斥性，操作就不会 wait() 的前一刻被 signal() 就不会形成死锁

### 进程调度

- 调度方式

	- 可剥夺式
	- 不可剥夺式

- 三级调度

	- 高级调度

		- 决定处于【输入池】中的哪个【后备作业】可以调入【主系统】做好运行的准备，成为一个或一组【就绪】程序
		- 一个作业只需经过一次高级调度

	- 中级调度

		- 决定处于【交换区】中的哪个【就绪】程序可以调入【内存】

	- 低级调度

		- 决定处于【内存】中的哪个【就绪】程序可以占用 【CPU】

- 调度算法

	- 先来先服务 （FCFS）

		- 宏观调度
		- 特点

			- 利于长作业，不利于短作业
			- 利于 CPU 繁忙的作业，不利于 I/O 繁忙的作业

	- 时间片轮转

		- 微观调度
		- 目的

			- 提高资源利用率

		- 固定时间片
		- 可变时间片

	- 优先级调度

		- 静态优先级
		- 动态优先级（随着等待时间增长，优先级提高）

	- 多级反馈调度

		- 时间片轮转算法和优先级算法的综合与发展
		- 照顾了短进程以提高系统吞吐量，缩短了平均周转时间
		- 照顾 I/O 型进程以获得较好的 I/O 设备利用率和缩短响应时间
		- 不必估计进程的执行时间，动态调节优先级

- 进程优先级确定

	- I/O 型进程进入最高优先级队列
	- 计算型进程每次执行完时间片后进入更低级队列
	- I/O 次数不多，主要是 CPU 处理的进程，在 I/O 完成后，返回优先 I/O 请求时离开的队列，以免每次都回到最高优先级队列后再逐次下降
	- 为适应一个进程在不同时间段的运行特点，I/O 完成时，提高优先级；时间片用完时，降低优先级

### 死锁

- 指两个以上的进程互相都要求对方已经占有的资源导致无法继续运行下去的现象
- 举例

	- 同类资源分配不当

		- 系统中有 m 个资源被 n 个进程共享，每个进程都要求 k 个资源，当 m < nk 时，会引起死锁

	- PV 操作使用不当

		- S1 S2 同时 P 操作变为 -1

- 死锁产生的原因和四个必要条件

	- 原因

		- 竞争资源
		- 进程推进顺序非法

	- 必要条件

		- 互斥条件
		- 请求保持条件
		- 不可剥夺条件
		- 环路条件

- 死锁的处理

	- 鸵鸟策略（不理睬策略）
	- 预防策略

		- 限制并发进程对资源的请求，破坏死锁产生的四个必要条件之一
		- 预先静态分配法

			- 预先分配所需资源，保证不等待资源
			- 资源利用率低，降低进程的并发程度

		- 资源有序分配法

			- 破坏环路条件
			- 限制进程对资源的请求
			- 资源的排序占用系统开销

	- 避免策略

		- 银行家算法

			- 发现分配资源后系统进入不安全状态，则不予分配；若分配后系统仍处于安全状态，则实施分配

		- 安全状态

			- 指系统能按某种顺序如 <P1, P2, ..., Pn> 来为每个进程分配其所需资源，直到最大需求，使得每个进程都可顺序完成。则称 <P1, P2, ..., Pn> 为安全序列

	- 检测与解除死锁

		- 死锁检测

			- 系统定时地运行一个死锁检测程序，判断系统是否发生死锁，若检测到有死锁，则设法加以解除

		- 死锁解除

			- 资源剥夺法
			- 撤销进程法

## 存储管理

### 概念

- 存储器管理的对象是主存存储器简称主存或内存
- 存储器管理的主要功能

	- 主存空间的分配和回收
	- 提高主存的利用率
	- 扩充主存
	- 对主存信息实现有效保护

- 存储器的结构

	- 寄存器-主存-外存结构
	- 寄存器-高速缓存-主存-存储组织的功能外存结构

- 虚拟地址

	- 符号名地址（名地址）——数据的存放地址
	- 符号名地址空间（名空间）——源程序的符号空间
	- 从 0 编址，顺序分配所有符号名对应的地址单元
	- 称为相对地址、程序地址、逻辑地址或虚拟地址

- 地址空间

	- 名空间

		- 程序中由符号名组成的空间

	- 逻辑地址空间

		- 程序中由相对地址组成的空间

	- 物理地址空间

		- 相对地址空间通过地址再定位机构转换到绝对地址空间

- 地址重定位

	- 指将逻辑地址变换称主存物理地址的过程
	- 静态地址重定位

		- 指程序【装入主存时】已经完成了重定位，【在程序执行期间将不会再发生变化】
		- 优点

			- 无须硬件地址变换机构，只要求程序本身是可重定位的

		- 缺点

			- 必须给作业分配一个连续的存储空间
			- 在作业执行期间不能扩充存储空间，也不能在主存中移动
			- 多个作业也难以共享主存中的同一程序副本和数据

	- 动态地址重定位

		- 指在程序【运行期间】完成重定位
		- 优点

			- 程序在执行期间可以换入和换出主存
			- 可以在主存中移动，把主存中的碎片集中起来，以充分利用空间
			- 不必给程序分配连续的主存空间，可以较好地利用较小地主存块
			- 可以实现共享

		- 缺点

			- 依赖硬件地址变换机构

				- 如基地址寄存器（BR）

### 存储管理方案

- 分区存储管理

	- 基本思想：将主存地用户区划分为若干个区域，每个区域分配给一个用户作业使用，并限定它们只能在自己的区域中运行
	- 方案

		- 固定分区

			- 静态分区方式（在系统生成时进行）
			- 管理表格

				- 主存分配情况表

			- 缺点

				- 造成空间浪费，通常将【已分配分区的未用空间】称为零头或内碎片

		- 可变分区

			- 动态分区方式（在作业装入时进行）
			- 分区个数可变，分区的大小正好等于作业的大小
			- 管理表格

				- 已分配表
				- 未分配表

			- 请求和释放分区算法

				- 最佳适应算法

					- 找到最接近用户需求的分区
					- 优点

						- 保留较大的空白区

					- 缺点

						- 空闲区不可能刚好等于用户要求的区，必然要将一个分区一分为二，会产生无用小分区，称为外碎片（未分配小分区）

				- 最差适应算法

					- 将用户作业装入最大的空白分区
					- 优点

						- 不容易产生外碎片

				- 首次适应算法

					- 从【主存的低地址开始】选择一个能装入作业的空白区
					- 优点

						- 当用户释放空间时，容易实现相邻的空白区合并

				- 循环首次适应算法

					- 从【刚分配的空白区开始】寻找一个能满足用户要求的空白区

		- 可重定位分区

			- 移动所有已分配好的分区，使之称为连续区域
			- 分区”靠拢“的时机是当用户请求空间得不到满足时或某个作业执行完毕时
			- 当进行分区”靠拢"时会导致地址发生变化，所以有地址重定位问题

	- 分区保护

		- 防止未经核准的用户访问分区
		- 上界/下界寄存器保护

			- 上界寄存器 <= 物理地址 <= 下界寄存器

		- 基址/限长寄存器保护

			- 基址寄存器 <= 物理地址 < 基址寄存器 + 限长寄存器

- 分页存储管理

	- 将一个【进程的地址空间】划分为若干个【大小相等】的区域，称为【页】；将【主存空间】划分成与页相同大小的若干个物理块，称为【块或页框】。在为进程分配主存时，将进程中若干页分别装入多个【不相邻接】的块中。

		- 分页的过程由操作系统完成，对用户透明，缺点是不易实现共享

	- 地址结构

		-    页号       页内地址
31    12 | 11                0

	- 页表

		- 为每个进程建立一张页面映射表
		- 每个页在页表中占用一个表项，记录该页在主存中对应的物理块号
		- 作用

			- 实现从页号到物理块号的地址映射

	- 地址变换机构

		- 将逻辑地址变为物理地址
		- 页表寄存器

			- 存放页表的始址和长度

				- 进程未执行时，放在进程的 PCB 中
				- 进程执行时，装入页表寄存器

		- 越界中断

			- 逻辑地址的页号 > 页表长度

	- 快表

		- 页式存储管理至少需要两次访问主存，第一次访问页表，第二次存取数据；若数据是间接地址，还要进行地址变换（> 2)
		- 快表是在地址映射机构中的一组高速寄存器，用来保存当前访问频率高的少数活动页的页号及相关信息
		- 查找联想存储器和查找主存页表是并行执行的

	- 两级页表机制

		- 将【页表】进行分页，离散地将各个页面分别存放在不同的物理块中
		- 第一层：外层页表（页表目录），每个表目是存放某个【页表】的物理地址
		- 第二层：页表，每个表目存放页对应的物理块号

- 分段存储管理

	- 作业的地址空间被划分为若干个段，每个段是一组完整的逻辑信息，各段【长度不相等】

		- 段是信息的逻辑单位，优点是易于实现段的共享，即允许若干个进程共享一个或多个段

	- 地址结构

		-    段号       段内地址
31    16 | 15               0

	- 段表

		- 为每个进程建立一张段映射表
		- 每个段在段表中占有一个表项，记录了该段在主存中的起始地址和长度
		- 段表实现了从逻辑段到物理主存区的映射

	- 段表寄存器

		- 存放段表始址和长度

	- 越界中断

		- 逻辑地址的段号 S >= 段表长度
		- 逻辑地址的段内地址 d >= 该段的段长 SL
		- 未越界，则物理地址 = 段基址 S' + 段内地址 d

- 段页式存储管理

	- 先将整个主存划分为大小相等的存储块（页框），将用户程序按程序的逻辑关系分为若干个段，并为每个段赋予一个段名，再将每个段划分成若干页，以页框为单位离散分配

		- 既具有分页系统能够提高主存利用率的优点，又具有分段系统能够很好地满足用户需要的长处

	- 地址结构

		- [段号 s  段内页号 p  页内地址 w]

	- 段表

		- 段的主存始址和段长

	- 页表

		- 页表始址和页表长度

	- 段表寄存器

		- 存放段表起始地址和段表长度

	- 地址变换

		- 根据段号 S 查段表，得到页表的起始地址
		- 根据页号 P 查页表，得到物理块号 b
		- 将物理块号 b 拼页内地址 W 得到物理地址

- 虚拟存储管理

	- 一个作业只部分装入主存便可开始启动运行，其余部分暂时留在磁盘上，在需要时再装入主存

		- 虚拟主存是为了扩大主存容量而采用的一种【设计方法】，其容量是由计算机的地址结构决定的

	- 程序局限性原理

		- 在一段时间内，程序的执行仅局限于某个部分
		- 时间局限性

			- 某条指令在不久的将来再次被执行
			- 某个存储单元在不久后再次被访问
			- 原因：存在大量的循环操作

		- 空间局限性

			- 某个被访问的存储单元附近的存储单元最有可能被访问，即程序在一段时间内所访问的地址集中在一定的范围内
			- 原因：程序是顺序执行的

	- 虚拟存储器的实现

		- 虚拟存储器是具有请求调入功能和置换功能，能仅把作业的一部分装入主存便可运行作业的存储器系统，逻辑上扩充主存容量。
其逻辑容量由主存和外存容量之和以及 CPU 可寻址范围决定
		- 实现方式

			- 请求分页系统

				- 在分页系统上增加了请求调页和页面置换功能
				- 允许只装入若干页的用户程序和数据就可以运行
				- 以页面为单位

			- 请求分段系统

				- 在分段系统上增加了请求调段和分段置换功能
				- 以段为单位

			- 请求段页式系统

				- 在段页式系统上增加了请求调页和页面置换功能

	- 请求分页管理的实现

		- 在页表中增加若干项（如状态位、访问字段和辅存地址等）在换进换出时参考
		- 增加功能：产生和处理缺页中断；从主存中换出一页实现虚拟存储
		- 缺页中断和一般中断的区别

			- 缺页中断：在指令执行期间产生和处理中断信号
一般中断：在一条指令执行完，下一条指令开始执行前检查和处理中断信号
			- 缺页中断：返回到被中断指令的开始重新执行该指令
一般中断：返回到下一条指令执行
			- 一条指令在执行期间可能会产生多次缺页中断

	- 页面置换算法

		- 最佳(Optimal)置换算法

			- 淘汰在最长时间内不再被访问的页面
			- 性能最好，难于实现（需要确定未来），用于评价其他算法

		- 先进先出(FIFO)算法

			- 淘汰最先进入主存的页面
			- 最直观、性能最差
			- Belady现象

				- 如果对一个进程未分配它所要求的全部页面，有时就会出现分配的页面数增多但缺页率反而提高的异常现象。

		- 最近最少未使用(Least Recently Used, LRU)算法

			- 淘汰最近最少未使用的页面
			- 在每个页面设置一个访问字段，用于记录这个页面自上次被访问以来所经历的时间 T，选择 T 最大的页面淘汰
			- 需要硬件支持（寄存器或栈）

		- 最近未用算法(Not Used Recently, NUR)置换算法 （Clock算法）

			- 为每个页面设置一位访问位，页面形成一个循环队列。当某页被访问时，访问为置 1。选择一页淘汰时，循环检查队列中页面的访问位，如果是 0，则淘汰该页；若为 1，则置为 0，检查下一个页面，直到遇到访问位为 0 的页面。

	- 工作集

		- 把某进程在时间 t 的工作集记为 w(t, Δ)
变量 Δ 称为工作集“窗口尺寸”
工作集就是在某段时间间隔（Δ）里进程实际要访问的页面的集合
		- 程序在运行时对页面的访问是不均匀的，往往在某段时间内的访问局限于较少的若干个页面。如果能够预知程序在某段时间间隔内要访问哪些页面，并能将它们提前调入主存，将会大大地降低缺页率，从而减少置换工作，提高 CPU 的利用率。当每个工作集都已达到最小值时，虚存管理程序跟踪进程的缺页数量，根据主存中自由页面的数量可以适当增加其工作集的大小。

## 作业管理

### 概念

- 作业

	- 系统为完成一个用户的计算任务（或一次事务处理）所做的工作总和
	- 组成

		- 程序
		- 数据
		- 作业说明书

			- 作业基本情况

				- 用户名
				- 作业名
				- 编程语言
				- 最大处理时间

			- 作业控制

				- 作业控制方式
				- 作业步的操作顺序
				- 作业执行出错处理

			- 作业资源要求的描述

				- 处理时间
				- 优先级
				- 主存空间
				- 外设类型
				- 外设数量

- 作业步

	- 作业中的每一个步骤称为作业步

- 作业管理程序

	- 在操作系统中控制作业进入、执行和撤销的一组程序

- 操作系统可以进一步为每个作业创建作业步进程，完成用户的工作

### 作业与作业控制

- 作业控制

	- 脱机

		- 用户将自己的意图用作业控制语言（JCL）编写成作业说明书，连同作业提交给计算机系统

	- 联机

		- 操作系统向用户提供一组联机命令，用户可以用过终端输入命令将意图告知计算机

- 作业状态

	- 提交

		- 作业提交给计算机中心，通过输入设备送入计算机系统的过程状态

	- 后备

		- 通过 Spooling 系统将作业输入到计算机系统的后被存储器（磁盘）中，随时等待作业调度程度调度时的状态

	- 执行

		- 一旦作业被作业调度程序选中，为其分配了必要的资源，并为其建立相应的进程后，该作业便进入了执行状态

	- 完成

		- 当作业正常结束或异常终止时，作业进入完成状态

- 作业控制块（JCB）

	- 记录与改作业有关的各种信息的登记表
	- 是作业存在的唯一标志
	- 包括用户名、作业名和状态标志等信息

- 作业后备队列

	- 由作业控制块组成的一个或多个队列

### 作业调度

- 目的

	- 均衡地使用系统资源
	- 平衡系统和用户的要求

- 作业调度算法

	- 先来先服务

		- 启动等待时间最长的作业

	- 短作业优先

		- 启动要求运行时间最短的作业

	- 响应比高优先

		- 响应比高的作业优先启动
		- 响应比 Rp = 作业响应时间 / 作业执行时间
		- 作业响应时间 = 作业等候时间 + 作业执行时间

	- 优先级调度算法
	- 均衡调度算法

		- 根据系统的运行情况和作业本身的特性对作业进行分类
		- 作业调度程序轮流地从这些不同类别的作业中挑选作业执行

- 作业调度算法性能的衡量指标

	- 用平均周转时间或带权平均周转时间来衡量调度性能的优劣
	- 作业的周转时间 = 作业的完成时间 - 作业的提交时间
	- 作业的带权周转时间 = 作业的周转时间 / 作业的执行时间

### 用户界面

- 用户界面也称用户接口或人机界面
- 用户界面的发展阶段

	- 控制面板式用户界面
	- 字符用户界面
	- 图形用户界面
	- 新一代用户界面

		- 通过虚拟现实技术

## 文件管理

### 概念

- 文件

	- 具有符号名，在逻辑上具有完整意义的一组相关信息项的集合
	- 文件体

		- 文件真实的内容

	- 文件说明

		- 操作系统为了管理文件所用到的信息
		- 如文件名、文件内部标识、文件类型、文件存储地址、文件的长度、访问权限、建立时间、访问时间等

	- 文件名

		- 进程创建文件时确定
		- 操作系统根据文件名对文件进行管理和控制

- 信息项

	- 构成文件内容的基本单位，可以是一个字符，也可以是一个记录，记录可以等长或不等长

- 文件系统

	- 操作系统中实现文件统一管理的一组软件和相关数据的集合
	- 功能

		- 按名存取
		- 统一的用户接口
		- 并发访问和控制
		- 安全性控制
		- 优化性能
		- 差错恢复

- 文件类型

	- 按文件性质和用途

		- 系统文件
		- 库文件
		- 用户文件

	- 按信息保存期限

		- 临时文件
		- 档案文件
		- 永久文件

	- 按文件的保护方式

		- 只读文件
		- 读/写文件
		- 可执行文件
		- 不保护文件

	- 按 UNIX 系统分类

		- 普通文件
		- 目录文件
		- 设备文件（特殊文件）

### 文件的结构和组织

- 结构

	- 文件的结构是指文件的组织形式
	- 用户看到的文件组织形式是文件的逻辑结构
	- 文件在文件存储器上的存放方式是文件的物理结构

- 逻辑结构

	- 有结构的记录式文件

		- 由一个以上的记录构成的文件
		- 记录通常描述一个实体集，有着相同或不同数目的数据项
		- 定长记录

			- 文件的长度用记录数目表示
			- 处理方便，开销小

		- 变长记录

			- 数据项本身的长度不定
			- 在处理前每个记录的长度是可知的

	- 无结构的流式文件

		- 由一串顺序字符流构成的文件
		- 文件体为字符流，不划分记录
		- 顺序访问，每次访问可以指定长度，长度以字节为单位
		- 采用读/写指针
		- 记录是文件的一个特例

- 物理结构

	- 连续结构（顺序结构）

		- 将逻辑上连续的文件信息依次存放在连续编号的物理块上
		- 文件存取：起始物理块号 + 文件长度
		- 缺点：不利于记录的增加或删除

			- 解决办法

				- 运行记录文件（Log File）
				- 事务文件（Transactor File）
				- 每隔一定时间将运行记录文件与主文件合并，这样不用每次对记录继续增删操作，物理移动磁盘信息，使其成为连续结构

	- 链接结构（串联结构）

		- 将逻辑上连续的文件信息存放在不连续的物理块上
		- 每个物理块设有一个指针指向下一个物理块

	- 索引结构

		- 将逻辑上连续的文件信息存放在不连续的物理块上
		- 系统为每个文件建立一张索引表，索引表记录了文件信息所在的每一个逻辑块号对应的物理块号，并将索引表的起始地址放在与文件对应的文件目录项（FCB）中

	- 多个物理块的索引表

		- 索引表是在文件创建时由系统自动建立的，并与文件一起存放在同一文件卷上
		- 索引表的组织方式

			- 链接文件
			- 多重索引方式

### 文件目录

- 文件目录是文件控制块的有序集合
- 文件控制块（PCB）

	- 系统需要为每个文件配置用于描述和控制文件的数据结构
	- 包括文件名和存放文件的物理地址
	- 也称为文件的说明或文件目录项（目录项）
	- 包含信息

		- 基本信息类

			- 文件名
			- 文件的物理地址
			- 文件长度
			- 文件块数

		- 存取控制信息类

			- 文件的存取权限

		- 使用信息类

			- 文件建立日期
			- 最后一次修改日期
			- 最后一次访问日期
			- 当前使用的信息

- 目录结构

	- 一级目录结构

		- 目录组织为线性结构
		- 只有一张目录表
		- 系统为每个文件分配一个目录项
		- 优点：结构简单
		- 缺点：查找速度慢，不允许重名，不便于实现文件共享

	- 二级目录结构

		- 主文件目录（MFD）
		- 用户目录（UFD）

			- 由用户所有文件的目录项组成

		- 在主文件目录中，每个用户文件目录都占有一个目录项，其目录项包括用户名和指向该用户文件目录的指针
		- 优点：提高检索目录的速度，较好地解决了重名问题
		- 缺点：隔离了用户，不便于共享文件

	- 多级目录结构

		- 树形目录结构
		- 由树根向下，每个节点是一个目录，叶结点是文件
		- 路径名

			- 绝对路径

				- 从根目录开始

			- 相对路径

				- 从当前目录开始

### 存取方法和存储空间的管理

- 文件存取方法

	- 顺序存取
	- 随机存取

- 文件存储空间的管理

	- 外存空闲空间管理的数据结构

		- 磁盘分配表

	- 空闲空间的管理方法

		- 空闲区表

			- 外存空间上的一个连续的未分配区域
			- 空闲表

				- 操作系统为磁盘外存上的所有空闲区建立一张空闲表
				- 每个表项对应一个空闲区
				- 空闲表中包括序号、空闲区的第一块号、空闲块的块数和状态（可不可用）

		- 位示图(Bitmap)

			- 记录文件存储器的使用情况
			- 每一位对应文件存储器上的一个物理块，0 表示空闲，1 表示占用
			- 字长 x 位，表示一个字对应 x 块
			- 位示图的大小由磁盘空间的大小（物理块总数）决定

		- 空闲块链

			- 每个空闲物理块中有指向下一个空闲物理块的指针，所有空闲物理块构成一个链表，不需要磁盘分配表

		- 成组链接法

			- 系统将空闲块分成若干组，每 100 个空闲块为一组，每组的【第一个】空闲块登记了下一组空闲块的【物理盘块号和空闲块总数】
			- 假如某个组的第一个空闲块号等于 0，意味着该组是最后一组，无下一组空闲块

### 文件的使用

- 文件系统为每个文件与该文件在磁盘上的存放位置建立了对应关系
- 当用户使用文件时，文件系统通过用户给出的文件名查出对应文件的存放位置，读出文件的内容
- 操作系统在操作级向用户提供的命令

	- 目录管理类命令
	- 文件操作类命令

		- 复制
		- 删除
		- 修改

	- 文件管理类命令

		- 设置文件权限

### 文件的共享和保护

- 文件共享

	- 文件共享是指不同用户进程使用同一文件，可以节省大量主存空间，减少访问外存次数
	- 实现文件共享

		- 采用文件名和文件说明分离的目录结构

	- 文件链接

		- 硬链接
（基于索引结构的链接）

			- 指两个文件目录表指向同一个索引结点的链接
			- 即不同文件名与同一个文件实体的链接
			- 缺点：不利于文件主删除文件（因为首先需要删除所有的硬链接，否则造成共享该文件的用户的目录项指针悬空）

		- 符号链接

			- 建立新的文件或目录，并与原来文件或目录的路径名进行映射
			- 缺点：需要增加读盘次数

				- 因为其他用户去读符号链接的共享文件时，系统中根据给定的文件路径名逐个分量地去查找目录，通过多次读盘操作才能找到该文件的索引结点，而用硬链接的共享文件的目录文件表目中已包括了共享文件的索引结点号

- 文件保护

	- 文件系统对文件的保护常采用存取控制方式进行。所谓存取控制，就是不同的用户对文件的访问规定不用的权限，以防止文件被未经文件主同意的用户访问
	- 存取控制矩阵

		- 行名：用户
		- 列名：文件名
		- 矩阵元素：权限

			- R——可读
			- W——可写
			- X——可执行

		- 优点：简单、清楚
		- 缺点：占用大量存储空间

	- 存取控制表

		- 按用户对文件的访问权力的差别对用户进行分类
		- 分类

			- 文件主
			- 同组用户
			- 其他用户

		- 存取控制表可放在每个文件的文件控制块中

	- 用户权限表

		- 以用户或用户组为单位将用户可存取的文件集中起来存入表中，称为用户权限表

	- 密码

### 系统的安全和可靠性

- 安全性管理

	- 系统的安全涉及两类不同的问题，一类涉及技术、管理、法律、道德和政治等问题，另一类涉及操作系统的安全机制
	- 系统级

		- 注册和登录

	- 用户级

		- 对所有用户分类
		- 对指定用户分配访问权

	- 目录级

		- 与用户权限无关
		- 只有系统核心可以写目录

	- 文件级

		- 通过系统管理员或文件主对文件属性的设置来控制用户对文件的访问

			- 只执行
			- 隐含
			- 只读
			- 读/写
			- 共享
			- 系统

		- 用户对文件的访问

			- 用户访问权
			- 目录访问权
			- 文件属性

- 可靠性

	- 文件系统的可靠性是指系统抵抗和预防各种物理性破坏和人为性破坏的能力
	- 保护信息的途径

		- 转储和恢复

			- 静态转储
			- 动态转储
			- 海量转储
			- 增量转储

		- 日志文件

			- 插入
			- 删除
			- 修改

		- 文件系统的一致性

			- 一致性检查包括块的一致性检查和文件的一致性检查

## 设备管理

### 概念

- 设备

	- 按数据组织

		- 块设备

			- 磁盘

		- 字符设备

			- 交互式终端
			- 打印机

	- 按功能

		- 输入设备
		- 输出设备
		- 存储设备
		- 网络联网设备
		- 供电设备

	- 按资源分配

		- 独占设备

			- 用户终端
			- 打印机

		- 共享设备

			- 磁盘

		- 虚拟设备

			- 假脱机技术（Spooling技术）

	- 按数据传输率

		- 低速设备

			- 键盘
			- 鼠标
			- 语音输入

		- 中速设备

			- 打印机
			- 激光打印机

		- 高速设备

			- 磁带机
			- 磁盘机
			- 光盘机

- 功能

	- 动态地掌握并记录设备的状态
	- 设备分配和释放
	- 缓冲区管理
	- 实际物理 I/O 设备操作
	- 提供设备使用的用户接口
	- 设备的访问和控制

- 目的

	- 提高设备利用率

		- 即提高 CPU 和 I/O 设备之间的并行程度

	- 方便用户

- 技术

	- 中断技术
	- 通道技术
	- DMA 技术
	- 缓冲技术

### I/O 软件

- 基本思想：分层构造

	- 底层与硬件相关
	- 硬件与较高层次软件隔离
	- 最高层次软件提供接口

- 目标

	- 设备独立性
	- 统一命名

- 层级

	- 硬件

		- 执行 I/O 操作、产生中断

	- 中断处理程序

		- 当 I/O 结束时唤醒驱动程序

	- 设备驱动程序

		- 置设备寄存器、检查状态

	- 与设备无关的系统软件

		- 命名、保护、阻塞、缓冲、分配

	- 用户级软件

		- 进行 I/O 调用、格式化 I/O、Spooling

### 相关技术

- 通道技术

	- 目的

		- 使数据的传输独立于 CPU

	- 步骤

		- CPU 向通道发出 I/O 命令
		- 通道收到命令后，从主存中取出本次 I/O 要执行的通道程序并执行
		- 仅当通道完成了 I/O 任务之后才向 CPU 发出中断信号

	- 类别

		- 字节多路通道
		- 数组选择通道
		- 数组多路通道

- DMA 技术
（直接主存存取）

	- 基本思想

		- 指数据在主存与 I/O 设备间直接成块传送
		- 不需要 CPU 的任何干涉

	- 步骤

		- CPU 在过程开始启动时向设备发出“传送一块数据”的命令
		- DMA 硬件完成操作
		- CPU 在过程结束时通过轮询或中断得知过程是否结束和下次操作是否准备就绪

- 缓冲技术

	- 硬件缓冲

		- 硬件寄存器

	- 软件缓冲

		- 操作系统

	- 引入缓冲的原因

		- 缓和 CPU 和 I/O 设备间速度不匹配的矛盾
		- 减少对 CPU 的中断频率，放宽对中断响应时间的限制
		- 提高 CPU 和 I/O 设备之间的并行性

	- 缓冲区

		- 单缓冲
		- 双缓冲
		- 多缓冲
		- 环形缓冲

- Spooling 技术
（外围设备联机操作）

	- 实际上是用一类物理设备模拟另一类物理设备的技术，使独占使用的设备变成多台虚拟设备的技术，也是一种速度匹配技术
	- 组成

		- 预输入程序
		- 缓输出程序
		- 井管理程序
		- 输入井

			- 存放输入设备输入的信息
			- 井中作业状态

				- 提交状态

					- 作业的信息正从输入设备上预输入

				- 后备状态

					- 作业预输入结束但未被选中执行

				- 执行状态

					- 作业已被选中执行
					- 运行过程中，它可从输入井中读取数据信息，也可向输出井些信息

				- 完成状态

					- 作业已经撤离，该作业的执行结果等待缓输出

		- 输出井

			- 存放作业执行的结果

		- 作业表

			- 登记进入系统的所有作业的作业名、状态和预输入表位置等信息

		- 预输入表

			- 每个用户作业都拥有，登记该作业的各个文件的情况

### 磁盘调度

- 磁盘

	- 磁盘是可被多个进程共享的设备
	- 系统每一时刻只允许一个进程启动磁盘进行 I/O 操作
	- 调度算法

		- 目的

			- 使得各进程对磁盘的平均访问（主要是寻道）时间最小（即平均寻道时间最小)

		- 分类

			- 移臂调度
			- 旋转调度

	- 属性

		- 盘片
		- 磁头
		- 磁道
		- 扇区
		- 柱面
		- 磁盘容量

			- 存储容量 = 磁头数 × 磁道(柱面)数 × 每道扇区数 × 每扇区字节数

- 移臂调度

	- 先来先服务（FCFS）

		- 优点：公平，简单
		- 缺点：平均寻道时间较长

	- 最短寻道时间优先
(Shorest Seek Time First, SSTF)

		- 访问的磁道与当前磁头所在的磁头所在的磁道距离最近（贪心）
		- 不能保证平均寻道时间最短

	- 扫描算法（SCAN）（电梯调度算法）

		- 访问与当前磁道距离最短的磁道
		- 符合磁头当前的移动方向
		- 直到再无更外的磁道需要访问时才换向
		- 避免了饥饿现象

	- 单向扫描调度算法（CSCAN）

		- 磁头只做单向移动（例如由里向外走到最外后，直接返回最里面，途中不接受请求，之后重复向外）

- 旋转调度

	- 选择延迟时间最短的进程对磁盘的扇区进行访问
	- 情况

		- 同一磁道不同扇区
		- 不同磁道不同扇区
		- 不同磁道相同扇区

*XMind: ZEN - Trial Version*