---
title: 基于 Python 的机器学习实践
date: 2020-06-11 10:44:40
tags: 
- Data Science
- Python
- Machine Learning
categories:
- Data Science
toc: true
reward: true
---

<!--more-->

## 常用机器学习算法

-|无监督|有监督
:-:|:--|:--
连续型|聚类与维度下降<br/>- SVD<br/> - PCA<br/>- K-Means|回归<br/>- 线性回归<br />- 多项式回归<br />决策树<br />随机森林
分类型|关联分析<br />- Apriori<br />   - FP-Growth<br />隐含马尔可夫模型|分类<br />- KNN<br />- 逻辑回归<br />- 朴素贝叶斯<br />- SVM

选择算法的注意点：

- 目的是什么？聚类？分类？……
- 有无标签？
- 是离散的数据还是连续的数据？

> 聚类和分类的区别：
>
> - 分类之前就能知道数据有哪几类
> - 聚类之后才能知道数据有哪几类

## 准备数据

- 已知数据
  ```mermaid
  graph LR
  A[训练集 Traing Set]-->B[模型训练]-->C[70%]-->D[95%]
  E[测试集 Test Set]-->F[模型评估]-->G[15%]-->H[2.5%]
  I[验证集 Validation Set]-->J[1.算法选择 2.参数调整]-->K[15%]-->L[2.5%]
  subgraph 机器学习中的数据集
  	A 
  	E 
  	I
  end
  subgraph 主要作用
  	B
  	F
  	J
  end
  subgraph 传统常用划分策略
  	C
  	G
  	K
  end
  subgraph 大数据时代常用划分策略
  	D
  	H
  	L
  end
  ```

  > **过拟合**：为了得到一致假设而使假设变得过度严格。
  >
  > 即在训练集上的错误率比在测试集上的错误率低。

## 机器学习实践

### 数据集

![image.png](https://i.loli.net/2020/06/11/DI49leyskCLHMg1.png)

- **无标签 `=>` 无监督学习算法**
- **连续数据**
- **目的**：**聚类**具有相似饮食习惯的国家

`=>` 选择 **`KMeans`算法**

---

### `KMeans` 算法的一般步骤

1. 原始数据集，假设有 `n` 个对象。设置 `k` 的取值，并在原始数据集中**随机选择 `k` 个对象**，如 `k = 2`
2. 在原始数据集中选择了 `k = 2` 个结点，将这些结点当作**聚类中心对象**。**计算其他对象与这些聚类中心对象之间的距离**，并根据**最小距离**，将其他结点**合并**入对应的聚类中心结点所属聚类，形成 `k = 2` 个**初始聚类**
3. 计算每个中间聚类结果的**均值**，在 `k = 2` 个中间聚类结果中找出 `k = 2` 个**新的聚类中心对象**（每个中间聚类结果中选择一个点，可以是实点，也可以是虚点）
4. **重新计算**每个对象与这些新的聚类中心对象之间的距离，并根据最小距离，**重新分类**，形成 `k = 2` 个中间聚类结果
5. 重复执行步骤**三和四（迭代）**。当所有对象的聚类情况**不再变化或已达到规定的循环次数时**，结束执行，并得到最终的聚类结果。

> 难点：**确定 `k` 的取值、确定初始聚类中心对象**

---

### 数据读入

```python
# 读入数据
import pandas as pd
# 读取 txt 文件使用 read_table, sep='\t'代表 txt 文件中数据之间的分隔符
protein = pd.read_table('protein.txt', sep='\t')
```

```python
# 查看前五条数据
protein.head()
```

|      |    Country     | RedMeat | WhiteMeat | Eggs | Milk | Fish | Cereals | Starch | Nuts | Fr&Veg |
| :--: | :------------: | :-----: | :-------: | :--: | :--: | :--: | :-----: | :----: | :--: | :----: |
|  0   |    Albania     |  10.1   |    1.4    | 0.5  | 8.9  | 0.2  |  42.3   |  0.6   | 5.5  |  1.7   |
|  1   |    Austria     |   8.9   |   14.0    | 4.3  | 19.9 | 2.1  |  28.0   |  3.6   | 1.3  |  4.3   |
|  2   |    Belgium     |  13.5   |    9.3    | 4.1  | 17.5 | 4.5  |  26.6   |  5.7   | 2.1  |  4.0   |
|  3   |    Bulgaria    |   7.8   |    6.0    | 1.6  | 8.3  | 1.2  |  56.7   |  1.1   | 3.7  |  4.2   |
|  4   | Czechoslovakia |   9.7   |   11.4    | 2.8  | 12.5 | 2.0  |  34.3   |  5.0   | 1.1  |  4.0   |

### 数据理解

```python
# 查看描述性统计分析
print(protein.describe())

>>> 
		RedMeat  WhiteMeat       Eggs       Milk       Fish    Cereals  \
count  25.000000  25.000000  25.000000  25.000000  25.000000  25.000000   
mean    9.828000   7.896000   2.936000  17.112000   4.284000  32.248000   
std     3.347078   3.694081   1.117617   7.105416   3.402533  10.974786   
min     4.400000   1.400000   0.500000   4.900000   0.200000  18.600000   
25%     7.800000   4.900000   2.700000  11.100000   2.100000  24.300000   
50%     9.500000   7.800000   2.900000  17.600000   3.400000  28.000000   
75%    10.600000  10.800000   3.700000  23.300000   5.800000  40.100000   
max    18.000000  14.000000   4.700000  33.700000  14.200000  56.700000   

          Starch       Nuts     Fr&Veg  
count  25.000000  25.000000  25.000000  
mean    4.276000   3.072000   4.136000  
std     1.634085   1.985682   1.803903  
min     0.600000   0.700000   1.400000  
25%     3.100000   1.500000   2.900000  
50%     4.700000   2.400000   3.800000  
75%     5.700000   4.700000   4.900000  
max     6.500000   7.800000   7.900000  
```

```python
# 查看列名
print(protein.columns)

>>> Index(['Country', 'RedMeat', 'WhiteMeat', 'Eggs', 'Milk', 'Fish', 'Cereals', 'Starch', 'Nuts', 'Fr&Veg'], dtype='object')
```

```python
# 查看行数和列数
print(protein.shape)

>>> (25, 10)
```

### 数据规整化处理

```python
from sklearn import preprocessing
# 由于 Country 不是一个特征值, 应删除
sprotein = protein.drop(['Country'], axis=1)

# 对数据进行标准化处理(不同自变量的取值范围不同, 有的值很大, 有的值很小)
sprotein_scaled = preprocessing.scale(sprotein)

# 查看处理结果
print(sprotein_scaled)

>>> 
[[ 0.08294065 -1.79475017 -2.22458425 -1.1795703  -1.22503282  0.9348045
  -2.29596509  1.24796771 -1.37825141]
 [-0.28297397  1.68644628  1.24562107  0.40046785 -0.6551106  -0.39505069
  -0.42221774 -0.91079027  0.09278868]
 [ 1.11969872  0.38790475  1.06297868  0.05573225  0.06479116 -0.5252463
   0.88940541 -0.49959828 -0.07694671]
 [-0.6183957  -0.52383718 -1.22005113 -1.2657542  -0.92507375  2.27395937
  -1.98367386  0.32278572  0.03621022]
 [-0.03903089  0.96810416 -0.12419682 -0.6624669  -0.6851065   0.19082957
   0.45219769 -1.01358827 -0.07694671]
 [ 0.23540507  0.8023329   0.69769391  1.13303099  1.68457011 -0.96233157
   0.3272812  -1.21918427 -0.98220215]
 [-0.43543839  1.02336124  0.69769391 -0.86356267  0.33475432 -0.71124003
   1.38907137 -1.16778527 -0.30326057]
 [-0.10001666 -0.82775116 -0.21551801  2.38269753  0.45473794 -0.55314536
   0.51465594 -1.06498727 -1.5479868 ]
 [ 2.49187852  0.55367601  0.33240914  0.34301192  0.42474204 -0.385751
   0.3272812  -0.34540128  1.33751491]
 [ 0.11343353 -1.35269348 -0.12419682  0.07009624  0.48473385  0.87900638
  -1.29663317  2.4301447   1.33751491]
 [-1.38071781  1.24438959 -0.03287563 -1.06465843 -1.19503691  0.73021139
  -0.17238476  1.19656871  0.03621022]
 [ 1.24167025  0.58130455  1.61090584  1.24794286 -0.62511469 -0.76703815
   1.20169663 -0.75659327 -0.69930983]
 [-0.25248108 -0.77249407 -0.03287563 -0.49009911 -0.26516381  0.42332173
  -1.35909141  0.63117972  1.45067184]
 [-0.10001666  1.57593211  0.60637272  0.90320726 -0.53512697 -0.91583314
  -0.04746827 -0.65379528 -0.24668211]
 [-0.13050955 -0.88300824 -0.21551801  0.88884328  1.62457829 -0.86003502
   0.20236471 -0.75659327 -0.81246676]
 [-0.89283166  0.63656164 -0.21551801  0.31428395 -0.38514744  0.35822393
   1.0143219  -0.55099728  1.39409338]
 [-1.10628185 -1.15929368 -1.67665709 -1.75412962  2.97439408 -0.48804755
   1.0143219   0.83677571  2.12961342]
 [-1.10628185 -0.44095155 -1.31137232 -0.86356267 -0.98506557  1.61368162
  -0.73450896  1.14516971 -0.75588829]
 [-0.83184589 -1.24217931  0.14976676 -1.22266225  0.81468882 -0.28345445
   0.88940541  1.45356371  1.73356417]
 [ 0.02195488 -0.0265234   0.51505153  1.08993904  0.96466835 -1.18552405
  -0.35975949 -0.85939127 -1.20851601]
 [ 0.99772718  0.60893309  0.14976676  0.96066319 -0.59511878 -0.61824316
  -0.9218837  -0.34540128  0.43225947]
 [ 2.30892121 -0.60672281  1.61090584  0.50101573  0.00479935 -0.73913909
   0.26482296  0.16858872 -0.47299597]
 [-0.16100243 -0.91063679 -0.76344517 -0.07354359 -0.38514744  1.05570042
   1.32661312  0.16858872 -0.69930983]
 [ 0.47934814  1.27201813  1.06297868  0.24246404 -0.26516381 -1.26922123
   0.57711418 -0.80799227 -0.19010364]
 [-1.65515377 -0.80012261 -1.5853359  -1.0933864  -1.10504919  2.19956187
  -0.79696721  1.35076571 -0.52957443]]
```

### 数据建模

```python
# 导入 KMeans 类型
from sklearn.cluster import KMeans
```

```python
# 【注意】k 值的选择方法: 枚举 k 的取值, 选择聚类效果最好的 K 值
NumberOfClusters = range(1, 20)
kmeans = [KMeans(n_clusters=i) for i in NumberOfClusters]
score = [kmeans[i].fit(sprotein_scaled).score(sprotein_scaled) for i in range(len(kmeans))]
# fit.score()的值: Calinski-Harabasz score——类内的稠密程度（协方差越小越好=>类内稠密）和类之间的离散程度（协方差越大越好=>类外离散）来评估聚类的效果
score

>>> 
[-225.00000000000003,
 -139.5073704483181,
 -110.40242709032154,
 -90.88898096315461,
 -75.85361543875908,
 -64.26912289585493,
 -52.84508547931431,
 -47.93122022451148,
 -41.95277071693862,
 -36.586708758547005,
 -34.35301231477139,
 -25.87455615045071,
 -22.79502514256965,
 -19.084670737161982,
 -17.271458466306022,
 -13.597310337368167,
 -11.02680783473527,
 -8.54546038166568,
 -6.7041060086011095]
```

```python
# 可视化
import matplotlib.pyplot as plt
%matplotlib inline
plt.plot(NumberOfClusters, score)
plt.xlabel('Number of Clusters')
plt.ylabel('Score')
plt.title('Elbow Curve')
plt.show()
```

![image.png](https://i.loli.net/2020/06/11/Md2YVKrm6RnApjJ.png)

> 这里选择 `k = 5`，因为 `k < 5` 时 `score` 上升明显，而 `k > 5` 时上升缓慢（**肘部法**，畸变程度）

```python
# 设置 KMeans 聚类器的超级参数
myKmeans = KMeans(Algorithm="auto", n_clusters=5, n_init=10, max_iter=200)
# n_clusters 为聚类中心的个数(k 值)
# n_init 和 max_iter: 初始值的选择次数以及最大迭代次数
# Algorithm="auto", 对于稀疏数据用 full(EM 算法), 非稀疏数据用 elkan 算法
```

```python
# 【注意】初始聚类方法的选择——init 参数, 目前 init 参数的取值可以为: 
    # 1) k-means++算法(默认): 选择彼此距离尽可能远的 k 个点
    # 2) 随机: random
    # 3) 指定: ndarray: 利用数组指定初始聚类中心对象点
```

```python
# 模型训练(对应统计学中的"拟合")
myKmeans.fit(sprotein_scaled)
```

### 查看模型

```python
# 查看模型(机器学习训练出的模型很可能是难以解释的, 但却是可用的)
print(myKmeans)

>>> KMeans(Algorithm='auto', copy_x=True, init='k-means++', max_iter=200,
       n_clusters=5, n_init=10, n_jobs=None, precompute_distances='auto',
       random_state=None, tol=0.0001, verbose=0)
```

### 模型预测

```python
# 预测聚类结果
y_kmeans = myKmeans.predict(sprotein)
print(y_kmeans)

>>> [1 0 0 1 4 2 0 2 0 1 1 0 1 0 2 4 3 1 1 2 0 0 1 0 1]
```

### 结果输出

```python
def print_kmcluster(k):
    '''用于聚类结果的输出
       k: 为聚类中心个数
    '''
    for i in range(k):
        print('聚类', i)
        ls = []
        for index, value in enumerate(y_kmeans):
            if i == value:
                ls.append(index)
        print(protein.loc[ls, ['Country', 'RedMeat', 'Fish', 'Fr&Veg']])
        
print_kmcluster(5)

>>> 
聚类 0
        Country  RedMeat  Fish  Fr&Veg
1       Austria      8.9   2.1     4.3
2       Belgium     13.5   4.5     4.0
6     E Germany      8.4   5.4     3.6
8        France     18.0   5.7     6.5
11      Ireland     13.9   2.2     2.9
13  Netherlands      9.5   2.5     3.7
20  Switzerland     13.1   2.3     4.9
21           UK     17.4   4.3     3.3
23    W Germany     11.4   3.4     3.8
聚类 1
       Country  RedMeat  Fish  Fr&Veg
0      Albania     10.1   0.2     1.7
3     Bulgaria      7.8   1.2     4.2
9       Greece     10.2   5.9     6.5
10     Hungary      5.3   0.3     4.2
12       Italy      9.0   3.4     6.7
17     Romania      6.2   1.0     2.8
18       Spain      7.1   7.0     7.2
22        USSR      9.3   3.0     2.9
24  Yugoslavia      4.4   0.6     3.2
聚类 2
    Country  RedMeat  Fish  Fr&Veg
5   Denmark     10.6   9.9     2.4
7   Finland      9.5   5.8     1.4
14   Norway      9.4   9.7     2.7
19   Sweden      9.9   7.5     2.0
聚类 3
     Country  RedMeat  Fish  Fr&Veg
16  Portugal      6.2  14.2     7.9
聚类 4
           Country  RedMeat  Fish  Fr&Veg
4   Czechoslovakia      9.7   2.0     4.0
15          Poland      6.9   3.0     6.6
```

